import { Injectable } from '@angular/core';
import { of, Subject, delay, take, switchMap, shareReplay, BehaviorSubject, timer, takeUntil, tap, } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class SharedDataService {
    constructor(httpClient) {
        this.httpClient = httpClient;
        this.TIMER_REFRESH = 1 * 60 * 60 * 1000;
        this.onDestroy$ = new Subject();
        this._itemData$ = new BehaviorSubject(undefined);
        this.timer$ = timer(this.TIMER_REFRESH, this.TIMER_REFRESH).pipe(takeUntil(this.onDestroy$));
        this.defaultRandomItemSearchRs = {
            resultList: [
                {
                    id: -1,
                    name: '',
                    desc: '',
                    text: '',
                    price: -1,
                    imageUrl: '',
                    quantity: -1,
                },
            ],
        };
        this.dataSource$ = this.getRandomItems(50).pipe(take(1));
        this.itemReplay$ = this._itemData$.pipe(switchMap((resp) => this.dataSource$), 
        // switchMapTo(this.dataSource$),
        shareReplay(1));
        this.timer$.subscribe((x) => this.updateData());
    }
    updateData() {
        this._itemData$.next(undefined);
    }
    getRandomItems(numOfItems, delayInMs) {
        const items = this.makeMockRandomItems(numOfItems);
        console.log('--------------------------------------');
        if (!delayInMs) {
            return of(items);
        }
        return of(items).pipe(delay(delayInMs));
    }
    searchRandomItems(searchText) {
        if (!searchText || searchText === '' || searchText.length < 1) {
            return of(this.defaultRandomItemSearchRs);
        }
        // if 30000, then browser freezing when rendering search result items because too many
        const items = this.makeMockRandomItems(300).filter((item) => item.name.includes(searchText));
        const result = { resultList: items };
        return of(result).pipe(tap((resp) => console.log('searchText: ', searchText, 'returning: ', resp.resultList.length)), delay(2000));
    }
    makeMockRandomItems(numOfItems) {
        if (!numOfItems) {
            numOfItems = 20;
        }
        const items = [];
        for (let i = 0; i < numOfItems; i++) {
            items.push({
                id: i,
                name: 'randomItem name ' + i,
                desc: 'randomItem desc ' + i,
                text: 'randomItem text ' + i,
                price: i,
                imageUrl: 'randomItem imageUrl ' + i,
                quantity: i,
            });
        }
        return items;
    }
    getNavBarConfig() {
        return this.httpClient.get('assets/config/nav-bar-config.json').pipe(tap((items) => console.log('getNavBarConfig result.size: ', (items && items.length) || '0')));
    }
    ngOnDestroy() {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    }
}
SharedDataService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: SharedDataService, deps: [{ token: i1.HttpClient }], target: i0.ɵɵFactoryTarget.Injectable });
SharedDataService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: SharedDataService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: SharedDataService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return [{ type: i1.HttpClient }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmVkLmRhdGEuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL29vcHMtbGliMDAyL3NyYy9saWIvc2hhcmVkL3NlcnZpY2VzL3NoYXJlZC5kYXRhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUN0RCxPQUFPLEVBRUwsRUFBRSxFQUNGLE9BQU8sRUFDUCxLQUFLLEVBQ0wsSUFBSSxFQUNKLFNBQVMsRUFDVCxXQUFXLEVBRVgsZUFBZSxFQUNmLEtBQUssRUFDTCxTQUFTLEVBQ1QsR0FBRyxHQUNKLE1BQU0sTUFBTSxDQUFDOzs7QUFNZCxNQUFNLE9BQU8saUJBQWlCO0lBc0I1QixZQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBckIxQyxrQkFBYSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQztRQUUzQixlQUFVLEdBQXFCLElBQUksT0FBTyxFQUFFLENBQUM7UUFFN0MsZUFBVSxHQUFHLElBQUksZUFBZSxDQUFPLFNBQVMsQ0FBQyxDQUFDO1FBQ2xELFdBQU0sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUV6Riw4QkFBeUIsR0FBK0I7WUFDN0QsVUFBVSxFQUFFO2dCQUNWO29CQUNFLEVBQUUsRUFBRSxDQUFDLENBQUM7b0JBQ04sSUFBSSxFQUFFLEVBQUU7b0JBQ1IsSUFBSSxFQUFFLEVBQUU7b0JBQ1IsSUFBSSxFQUFFLEVBQUU7b0JBQ1IsS0FBSyxFQUFFLENBQUMsQ0FBQztvQkFDVCxRQUFRLEVBQUUsRUFBRTtvQkFDWixRQUFRLEVBQUUsQ0FBQyxDQUFDO2lCQUNiO2FBQ0Y7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LENBQ3hELENBQUMsSUFBSSxDQUNKLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQkFBK0IsRUFBRSxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FDN0YsQ0FBQztJQUNKLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUM3QixDQUFDOzsrR0E3RlUsaUJBQWlCO21IQUFqQixpQkFBaUIsY0FGaEIsTUFBTTs0RkFFUCxpQkFBaUI7a0JBSDdCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7XHJcbiAgT2JzZXJ2YWJsZSxcclxuICBvZixcclxuICBTdWJqZWN0LFxyXG4gIGRlbGF5LFxyXG4gIHRha2UsXHJcbiAgc3dpdGNoTWFwLFxyXG4gIHNoYXJlUmVwbGF5LFxyXG4gIHN3aXRjaE1hcFRvLFxyXG4gIEJlaGF2aW9yU3ViamVjdCxcclxuICB0aW1lcixcclxuICB0YWtlVW50aWwsXHJcbiAgdGFwLFxyXG59IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBOYXZCYXJNb2RlbCwgUmFuZG9tSXRlbSwgUnNTZWFyY2hSZXN1bHQgfSBmcm9tICcuLi9tb2RlbHMnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290JyxcclxufSlcclxuZXhwb3J0IGNsYXNzIFNoYXJlZERhdGFTZXJ2aWNlIGltcGxlbWVudHMgT25EZXN0cm95IHtcclxuICBUSU1FUl9SRUZSRVNIID0gMSAqIDYwICogNjAgKiAxMDAwO1xyXG5cclxuICBwcml2YXRlIG9uRGVzdHJveSQ6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdCgpO1xyXG5cclxuICBwcml2YXRlIF9pdGVtRGF0YSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PHZvaWQ+KHVuZGVmaW5lZCk7XHJcbiAgcHJpdmF0ZSB0aW1lciQgPSB0aW1lcih0aGlzLlRJTUVSX1JFRlJFU0gsIHRoaXMuVElNRVJfUkVGUkVTSCkucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSk7XHJcblxyXG4gIHB1YmxpYyBkZWZhdWx0UmFuZG9tSXRlbVNlYXJjaFJzOiBSc1NlYXJjaFJlc3VsdDxSYW5kb21JdGVtPiA9IHtcclxuICAgIHJlc3VsdExpc3Q6IFtcclxuICAgICAge1xyXG4gICAgICAgIGlkOiAtMSxcclxuICAgICAgICBuYW1lOiAnJyxcclxuICAgICAgICBkZXNjOiAnJyxcclxuICAgICAgICB0ZXh0OiAnJyxcclxuICAgICAgICBwcmljZTogLTEsXHJcbiAgICAgICAgaW1hZ2VVcmw6ICcnLFxyXG4gICAgICAgIHF1YW50aXR5OiAtMSxcclxuICAgICAgfSxcclxuICAgIF0sXHJcbiAgfTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50KSB7XHJcbiAgICB0aGlzLnRpbWVyJC5zdWJzY3JpYmUoKHgpID0+IHRoaXMudXBkYXRlRGF0YSgpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBkYXRhU291cmNlJCA9IHRoaXMuZ2V0UmFuZG9tSXRlbXMoNTApLnBpcGUodGFrZSgxKSk7XHJcblxyXG4gIHB1YmxpYyBpdGVtUmVwbGF5JCA9IHRoaXMuX2l0ZW1EYXRhJC5waXBlKFxyXG4gICAgc3dpdGNoTWFwKChyZXNwKSA9PiB0aGlzLmRhdGFTb3VyY2UkKSxcclxuICAgIC8vIHN3aXRjaE1hcFRvKHRoaXMuZGF0YVNvdXJjZSQpLFxyXG4gICAgc2hhcmVSZXBsYXkoMSlcclxuICApO1xyXG5cclxuICBwdWJsaWMgdXBkYXRlRGF0YSgpIHtcclxuICAgIHRoaXMuX2l0ZW1EYXRhJC5uZXh0KHVuZGVmaW5lZCk7XHJcbiAgfVxyXG5cclxuICBnZXRSYW5kb21JdGVtcyhudW1PZkl0ZW1zPzogbnVtYmVyLCBkZWxheUluTXM/OiBudW1iZXIpOiBPYnNlcnZhYmxlPFJhbmRvbUl0ZW1bXT4ge1xyXG4gICAgY29uc3QgaXRlbXM6IFJhbmRvbUl0ZW1bXSA9IHRoaXMubWFrZU1vY2tSYW5kb21JdGVtcyhudW1PZkl0ZW1zKTtcclxuICAgIGNvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xyXG4gICAgaWYgKCFkZWxheUluTXMpIHtcclxuICAgICAgcmV0dXJuIG9mKGl0ZW1zKTtcclxuICAgIH1cclxuICAgIHJldHVybiBvZihpdGVtcykucGlwZShkZWxheShkZWxheUluTXMpKTtcclxuICB9XHJcblxyXG4gIHNlYXJjaFJhbmRvbUl0ZW1zKHNlYXJjaFRleHQ6IHN0cmluZyk6IE9ic2VydmFibGU8UnNTZWFyY2hSZXN1bHQ8UmFuZG9tSXRlbT4+IHtcclxuICAgIGlmICghc2VhcmNoVGV4dCB8fCBzZWFyY2hUZXh0ID09PSAnJyB8fCBzZWFyY2hUZXh0Lmxlbmd0aCA8IDEpIHtcclxuICAgICAgcmV0dXJuIG9mKHRoaXMuZGVmYXVsdFJhbmRvbUl0ZW1TZWFyY2hScyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gaWYgMzAwMDAsIHRoZW4gYnJvd3NlciBmcmVlemluZyB3aGVuIHJlbmRlcmluZyBzZWFyY2ggcmVzdWx0IGl0ZW1zIGJlY2F1c2UgdG9vIG1hbnlcclxuICAgIGNvbnN0IGl0ZW1zOiBSYW5kb21JdGVtW10gPSB0aGlzLm1ha2VNb2NrUmFuZG9tSXRlbXMoMzAwKS5maWx0ZXIoKGl0ZW0pID0+XHJcbiAgICAgIGl0ZW0ubmFtZS5pbmNsdWRlcyhzZWFyY2hUZXh0KVxyXG4gICAgKTtcclxuICAgIGNvbnN0IHJlc3VsdDogUnNTZWFyY2hSZXN1bHQ8UmFuZG9tSXRlbT4gPSB7IHJlc3VsdExpc3Q6IGl0ZW1zIH07XHJcbiAgICByZXR1cm4gb2YocmVzdWx0KS5waXBlKFxyXG4gICAgICB0YXAoKHJlc3ApID0+IGNvbnNvbGUubG9nKCdzZWFyY2hUZXh0OiAnLCBzZWFyY2hUZXh0LCAncmV0dXJuaW5nOiAnLCByZXNwLnJlc3VsdExpc3QubGVuZ3RoKSksXHJcbiAgICAgIGRlbGF5KDIwMDApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgbWFrZU1vY2tSYW5kb21JdGVtcyhudW1PZkl0ZW1zPzogbnVtYmVyKTogUmFuZG9tSXRlbVtdIHtcclxuICAgIGlmICghbnVtT2ZJdGVtcykge1xyXG4gICAgICBudW1PZkl0ZW1zID0gMjA7XHJcbiAgICB9XHJcbiAgICBjb25zdCBpdGVtczogUmFuZG9tSXRlbVtdID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bU9mSXRlbXM7IGkrKykge1xyXG4gICAgICBpdGVtcy5wdXNoKHtcclxuICAgICAgICBpZDogaSxcclxuICAgICAgICBuYW1lOiAncmFuZG9tSXRlbSBuYW1lICcgKyBpLFxyXG4gICAgICAgIGRlc2M6ICdyYW5kb21JdGVtIGRlc2MgJyArIGksXHJcbiAgICAgICAgdGV4dDogJ3JhbmRvbUl0ZW0gdGV4dCAnICsgaSxcclxuICAgICAgICBwcmljZTogaSxcclxuICAgICAgICBpbWFnZVVybDogJ3JhbmRvbUl0ZW0gaW1hZ2VVcmwgJyArIGksXHJcbiAgICAgICAgcXVhbnRpdHk6IGksXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGl0ZW1zO1xyXG4gIH1cclxuXHJcbiAgZ2V0TmF2QmFyQ29uZmlnKCk6IE9ic2VydmFibGU8TmF2QmFyTW9kZWxbXT4ge1xyXG4gICAgcmV0dXJuIChcclxuICAgICAgdGhpcy5odHRwQ2xpZW50LmdldCgnYXNzZXRzL2NvbmZpZy9uYXYtYmFyLWNvbmZpZy5qc29uJykgYXMgT2JzZXJ2YWJsZTxOYXZCYXJNb2RlbFtdPlxyXG4gICAgKS5waXBlKFxyXG4gICAgICB0YXAoKGl0ZW1zKSA9PiBjb25zb2xlLmxvZygnZ2V0TmF2QmFyQ29uZmlnIHJlc3VsdC5zaXplOiAnLCAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoKSB8fCAnMCcpKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5vbkRlc3Ryb3kkLm5leHQodHJ1ZSk7XHJcbiAgICB0aGlzLm9uRGVzdHJveSQuY29tcGxldGUoKTtcclxuICB9XHJcbn1cclxuIl19