import { Injectable } from '@angular/core';
import { of, map, tap } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class StateService {
    constructor(httpClient) {
        this.httpClient = httpClient;
        this.statesWithFlag$ = this.httpClient //
            .get('assets/mockdata/statesWithFlag.json'); // angular support asset in lib since v9
        // .get('../data/statesWithFlag.json') as Observable<UsState[]>;
    }
    getUsStates() {
        return this.statesWithFlag$;
    }
    searchUsStates(term) {
        console.log('searchStates ....', term);
        if (term === '') {
            return of([]);
        }
        return this.getUsStates().pipe(map((items) => {
            return (items.filter((item) => {
                // console.log('searchState ...', term, item.name.toLowerCase().indexOf(term.toLowerCase()));
                return item.stateName.toLowerCase().indexOf(term.toLowerCase()) >= 0;
            }) || []);
        }), tap((items) => console.log('search result.size: ', (items && items.length) || '0'))
        // tap((items) => console.log('search result.size: ', items))
        );
    }
    getUsStateCity() {
        return this.httpClient.get('assets/mockdata/cities.json').pipe(
        // return this.httpClient.get('../data/cities.json').pipe( // angular support asset in lib since v9
        map((data) => {
            let statesData;
            let states = [];
            // console.log('Loading states and cities ..... ', data);
            if (data) {
                statesData = Object.entries(data).sort();
                let sIdx = 0;
                statesData.forEach((stateData) => {
                    // console.log(`stateData[0]: `, stateData[0]);
                    // console.log(`stateData[1]: `, stateData[1]);
                    const state = this.makeUsState(sIdx, stateData[0]);
                    sIdx++;
                    let cIdx = 0;
                    stateData[1].sort().forEach((cityData) => {
                        const city = this.makeUsCityWithStateName(cIdx, cityData, state.stateName);
                        cIdx++;
                        state.cities.push(city);
                    });
                    states.push(state);
                });
            }
            // console.log(`StateService, getUsStateCity, states: `, states);
            console.log('StateService, getUsStateCity result.size: ', (states && states.length) || '0');
            return states;
        }));
    }
    getUsStateCitySlice(indexes) {
        return this.getUsStateCity().pipe(map((items) => {
            const result = [];
            items.forEach((item) => {
                if (indexes.includes(item.id)) {
                    result.push(item);
                }
            });
            return result;
        }));
    }
    getUsCities() {
        let cities = [];
        let retCities = [];
        return this.getUsStateCity().pipe(map((states) => {
            // console.log(`states: `, states);
            states.forEach((state) => {
                state.cities.forEach((cityData) => {
                    // console.log(`cityData: `, cityData);
                    const newCity = this.makeUsCityWithStateName(0, cityData.cityName, cityData.inStateName);
                    cities.push(cityData);
                });
            });
            cities.sort((a, b) => a.cityName.localeCompare(b.cityName));
            let cIdx = 0;
            cities.forEach((city) => {
                const newCity = this.makeUsCityWithStateName(cIdx, city.cityName, city.inStateName);
                cIdx++;
                retCities.push(newCity);
            });
            console.log(`Num of cities: `, retCities.length);
            return retCities;
        }));
    }
    makeUsState(idx, stateName) {
        const state = {};
        state.id = idx;
        state.stateName = stateName;
        state.cities = [];
        return state;
    }
    makeUsCity(idx, cityName) {
        const city = {};
        city.id = idx;
        city.cityName = cityName;
        return city;
    }
    makeUsCityWithStateName(idx, cityName, stateName) {
        const city = this.makeUsCity(idx, cityName);
        city.inStateName = stateName;
        return city;
    }
}
StateService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: StateService, deps: [{ token: i1.HttpClient }], target: i0.ɵɵFactoryTarget.Injectable });
StateService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: StateService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: StateService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return [{ type: i1.HttpClient }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL29vcHMtbGliMDAyL3NyYy9saWIvc2hhcmVkL3NlcnZpY2VzL3N0YXRlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQWMsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxNQUFNLENBQUM7OztBQU1oRCxNQUFNLE9BQU8sWUFBWTtJQUd2QixZQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3hDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFO2FBQ3RDLEdBQUcsQ0FBQyxxQ0FBcUMsQ0FBMEIsQ0FBQyxDQUFDLHdDQUF3QztRQUNoSCxnRUFBZ0U7SUFDbEUsQ0FBQztJQUVELFdBQVc7UUFDVCxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUM7SUFDOUIsQ0FBQztJQUVELGNBQWMsQ0FBQyxJQUFZO1FBQ3pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDdkMsSUFBSSxJQUFJLEtBQUssRUFBRSxFQUFFO1lBQ2YsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDZjtRQUNELE9BQU8sSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLElBQUksQ0FDNUIsR0FBRyxDQUFDLENBQUMsS0FBZ0IsRUFBRSxFQUFFO1lBQ3ZCLE9BQU8sQ0FDTCxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBYSxFQUFFLEVBQUU7Z0JBQzdCLDZGQUE2RjtnQkFDN0YsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7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Q0FBQztRQUVsQixPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCxVQUFVLENBQUMsR0FBVyxFQUFFLFFBQWdCO1FBQ3RDLE1BQU0sSUFBSSxHQUFXLEVBQVksQ0FBQztRQUNsQyxJQUFJLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQztRQUNkLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBRXpCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELHVCQUF1QixDQUFDLEdBQVcsRUFBRSxRQUFnQixFQUFFLFNBQWlCO1FBQ3RFLE1BQU0sSUFBSSxHQUFXLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1FBQzdCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7MEdBbklVLFlBQVk7OEdBQVosWUFBWSxjQUZYLE1BQU07NEZBRVAsWUFBWTtrQkFIeEIsVUFBVTttQkFBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBtYXAsIHRhcCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBVc0NpdHksIFVzU3RhdGUgfSBmcm9tICcuLi9tb2RlbHMnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290JyxcclxufSlcclxuZXhwb3J0IGNsYXNzIFN0YXRlU2VydmljZSB7XHJcbiAgZXJyb3JNZXNzYWdlPzogc3RyaW5nO1xyXG4gIHN0YXRlc1dpdGhGbGFnJDogT2JzZXJ2YWJsZTxVc1N0YXRlW10+O1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cENsaWVudDogSHR0cENsaWVudCkge1xyXG4gICAgdGhpcy5zdGF0ZXNXaXRoRmxhZyQgPSB0aGlzLmh0dHBDbGllbnQgLy9cclxuICAgICAgLmdldCgnYXNzZXRzL21vY2tkYXRhL3N0YXRlc1dpdGhGbGFnLmpzb24nKSBhcyBPYnNlcnZhYmxlPFVzU3RhdGVbXT47IC8vIGFuZ3VsYXIgc3VwcG9ydCBhc3NldCBpbiBsaWIgc2luY2UgdjlcclxuICAgIC8vIC5nZXQoJy4uL2RhdGEvc3RhdGVzV2l0aEZsYWcuanNvbicpIGFzIE9ic2VydmFibGU8VXNTdGF0ZVtdPjtcclxuICB9XHJcblxyXG4gIGdldFVzU3RhdGVzKCk6IE9ic2VydmFibGU8VXNTdGF0ZVtdPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zdGF0ZXNXaXRoRmxhZyQ7XHJcbiAgfVxyXG5cclxuICBzZWFyY2hVc1N0YXRlcyh0ZXJtOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFVzU3RhdGVbXT4ge1xyXG4gICAgY29uc29sZS5sb2coJ3NlYXJjaFN0YXRlcyAuLi4uJywgdGVybSk7XHJcbiAgICBpZiAodGVybSA9PT0gJycpIHtcclxuICAgICAgcmV0dXJuIG9mKFtdKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmdldFVzU3RhdGVzKCkucGlwZShcclxuICAgICAgbWFwKChpdGVtczogVXNTdGF0ZVtdKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgIGl0ZW1zLmZpbHRlcigoaXRlbTogVXNTdGF0ZSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnc2VhcmNoU3RhdGUgLi4uJywgdGVybSwgaXRlbS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0ZXJtLnRvTG93ZXJDYXNlKCkpKTtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uc3RhdGVOYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0ZXJtLnRvTG93ZXJDYXNlKCkpID49IDA7XHJcbiAgICAgICAgICB9KSB8fCBbXVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pLFxyXG4gICAgICB0YXAoKGl0ZW1zKSA9PiBjb25zb2xlLmxvZygnc2VhcmNoIHJlc3VsdC5zaXplOiAnLCAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoKSB8fCAnMCcpKVxyXG4gICAgICAvLyB0YXAoKGl0ZW1zKSA9PiBjb25zb2xlLmxvZygnc2VhcmNoIHJlc3VsdC5zaXplOiAnLCBpdGVtcykpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNTdGF0ZUNpdHkoKTogT2JzZXJ2YWJsZTxVc1N0YXRlW10+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0KCdhc3NldHMvbW9ja2RhdGEvY2l0aWVzLmpzb24nKS5waXBlKFxyXG4gICAgICAvLyByZXR1cm4gdGhpcy5odHRwQ2xpZW50LmdldCgnLi4vZGF0YS9jaXRpZXMuanNvbicpLnBpcGUoIC8vIGFuZ3VsYXIgc3VwcG9ydCBhc3NldCBpbiBsaWIgc2luY2UgdjlcclxuICAgICAgbWFwKChkYXRhKSA9PiB7XHJcbiAgICAgICAgbGV0IHN0YXRlc0RhdGE6IFtzdHJpbmcsIGFueV1bXTtcclxuICAgICAgICBsZXQgc3RhdGVzOiBVc1N0YXRlW10gPSBbXTtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygnTG9hZGluZyBzdGF0ZXMgYW5kIGNpdGllcyAuLi4uLiAnLCBkYXRhKTtcclxuICAgICAgICBpZiAoZGF0YSkge1xyXG4gICAgICAgICAgc3RhdGVzRGF0YSA9IE9iamVjdC5lbnRyaWVzKGRhdGEpLnNvcnQoKTtcclxuXHJcbiAgICAgICAgICBsZXQgc0lkeCA9IDA7XHJcbiAgICAgICAgICBzdGF0ZXNEYXRhLmZvckVhY2goKHN0YXRlRGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgc3RhdGVEYXRhWzBdOiBgLCBzdGF0ZURhdGFbMF0pO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgc3RhdGVEYXRhWzFdOiBgLCBzdGF0ZURhdGFbMV0pO1xyXG4gICAgICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXMubWFrZVVzU3RhdGUoc0lkeCwgc3RhdGVEYXRhWzBdKTtcclxuICAgICAgICAgICAgc0lkeCsrO1xyXG5cclxuICAgICAgICAgICAgbGV0IGNJZHggPSAwO1xyXG4gICAgICAgICAgICBzdGF0ZURhdGFbMV0uc29ydCgpLmZvckVhY2goKGNpdHlEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgY2l0eSA9IHRoaXMubWFrZVVzQ2l0eVdpdGhTdGF0ZU5hbWUoY0lkeCwgY2l0eURhdGEsIHN0YXRlLnN0YXRlTmFtZSk7XHJcbiAgICAgICAgICAgICAgY0lkeCsrO1xyXG4gICAgICAgICAgICAgIHN0YXRlLmNpdGllcy5wdXNoKGNpdHkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc3RhdGVzLnB1c2goc3RhdGUpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGBTdGF0ZVNlcnZpY2UsIGdldFVzU3RhdGVDaXR5LCBzdGF0ZXM6IGAsIHN0YXRlcyk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1N0YXRlU2VydmljZSwgZ2V0VXNTdGF0ZUNpdHkgcmVzdWx0LnNpemU6ICcsIChzdGF0ZXMgJiYgc3RhdGVzLmxlbmd0aCkgfHwgJzAnKTtcclxuICAgICAgICByZXR1cm4gc3RhdGVzO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGdldFVzU3RhdGVDaXR5U2xpY2UoaW5kZXhlczogbnVtYmVyW10pOiBPYnNlcnZhYmxlPFVzU3RhdGVbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0VXNTdGF0ZUNpdHkoKS5waXBlKFxyXG4gICAgICBtYXAoKGl0ZW1zOiBVc1N0YXRlW10pID0+IHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBbXTtcclxuICAgICAgICBpdGVtcy5mb3JFYWNoKChpdGVtOiBVc1N0YXRlKSA9PiB7XHJcbiAgICAgICAgICBpZiAoaW5kZXhlcy5pbmNsdWRlcyhpdGVtLmlkKSkge1xyXG4gICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGdldFVzQ2l0aWVzKCkge1xyXG4gICAgbGV0IGNpdGllczogVXNDaXR5W10gPSBbXTtcclxuICAgIGxldCByZXRDaXRpZXM6IFVzQ2l0eVtdID0gW107XHJcbiAgICByZXR1cm4gdGhpcy5nZXRVc1N0YXRlQ2l0eSgpLnBpcGUoXHJcbiAgICAgIG1hcCgoc3RhdGVzKSA9PiB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coYHN0YXRlczogYCwgc3RhdGVzKTtcclxuICAgICAgICBzdGF0ZXMuZm9yRWFjaCgoc3RhdGUpID0+IHtcclxuICAgICAgICAgIHN0YXRlLmNpdGllcy5mb3JFYWNoKChjaXR5RGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgY2l0eURhdGE6IGAsIGNpdHlEYXRhKTtcclxuICAgICAgICAgICAgY29uc3QgbmV3Q2l0eSA9IHRoaXMubWFrZVVzQ2l0eVdpdGhTdGF0ZU5hbWUoXHJcbiAgICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgICBjaXR5RGF0YS5jaXR5TmFtZSxcclxuICAgICAgICAgICAgICBjaXR5RGF0YS5pblN0YXRlTmFtZVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBjaXRpZXMucHVzaChjaXR5RGF0YSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY2l0aWVzLnNvcnQoKGEsIGIpID0+IGEuY2l0eU5hbWUubG9jYWxlQ29tcGFyZShiLmNpdHlOYW1lKSk7XHJcbiAgICAgICAgbGV0IGNJZHggPSAwO1xyXG4gICAgICAgIGNpdGllcy5mb3JFYWNoKChjaXR5KSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBuZXdDaXR5ID0gdGhpcy5tYWtlVXNDaXR5V2l0aFN0YXRlTmFtZShjSWR4LCBjaXR5LmNpdHlOYW1lLCBjaXR5LmluU3RhdGVOYW1lKTtcclxuICAgICAgICAgIGNJZHgrKztcclxuICAgICAgICAgIHJldENpdGllcy5wdXNoKG5ld0NpdHkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBOdW0gb2YgY2l0aWVzOiBgLCByZXRDaXRpZXMubGVuZ3RoKTtcclxuICAgICAgICByZXR1cm4gcmV0Q2l0aWVzO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIG1ha2VVc1N0YXRlKGlkeDogbnVtYmVyLCBzdGF0ZU5hbWU6IHN0cmluZyk6IFVzU3RhdGUge1xyXG4gICAgY29uc3Qgc3RhdGU6IFVzU3RhdGUgPSB7fSBhcyBVc1N0YXRlO1xyXG4gICAgc3RhdGUuaWQgPSBpZHg7XHJcbiAgICBzdGF0ZS5zdGF0ZU5hbWUgPSBzdGF0ZU5hbWU7XHJcbiAgICBzdGF0ZS5jaXRpZXMgPSBbXTtcclxuXHJcbiAgICByZXR1cm4gc3RhdGU7XHJcbiAgfVxyXG5cclxuICBtYWtlVXNDaXR5KGlkeDogbnVtYmVyLCBjaXR5TmFtZTogc3RyaW5nKTogVXNDaXR5IHtcclxuICAgIGNvbnN0IGNpdHk6IFVzQ2l0eSA9IHt9IGFzIFVzQ2l0eTtcclxuICAgIGNpdHkuaWQgPSBpZHg7XHJcbiAgICBjaXR5LmNpdHlOYW1lID0gY2l0eU5hbWU7XHJcblxyXG4gICAgcmV0dXJuIGNpdHk7XHJcbiAgfVxyXG5cclxuICBtYWtlVXNDaXR5V2l0aFN0YXRlTmFtZShpZHg6IG51bWJlciwgY2l0eU5hbWU6IHN0cmluZywgc3RhdGVOYW1lOiBzdHJpbmcpOiBVc0NpdHkge1xyXG4gICAgY29uc3QgY2l0eTogVXNDaXR5ID0gdGhpcy5tYWtlVXNDaXR5KGlkeCwgY2l0eU5hbWUpO1xyXG4gICAgY2l0eS5pblN0YXRlTmFtZSA9IHN0YXRlTmFtZTtcclxuICAgIHJldHVybiBjaXR5O1xyXG4gIH1cclxufVxyXG4iXX0=