import { Injectable } from '@angular/core';
import { of, map, tap } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class StateService {
    constructor(httpClient) {
        this.httpClient = httpClient;
        this.statesWithFlag$ = this.httpClient //
            .get('assets/mockdata/statesWithFlag.json');
    }
    getUsStates() {
        return this.statesWithFlag$;
    }
    searchUsStates(term) {
        console.log('searchStates ....', term);
        if (term === '') {
            return of([]);
        }
        return this.getUsStates().pipe(map((items) => {
            return (items.filter((item) => {
                // console.log('searchState ...', term, item.name.toLowerCase().indexOf(term.toLowerCase()));
                return item.stateName.toLowerCase().indexOf(term.toLowerCase()) >= 0;
            }) || []);
        }), tap((items) => console.log('search result.size: ', (items && items.length) || '0'))
        // tap((items) => console.log('search result.size: ', items))
        );
    }
    getUsStateCity() {
        return this.httpClient.get('assets/mockdata/cities.json').pipe(map((data) => {
            let statesData;
            let states = [];
            // console.log('Loading states and cities ..... ', data);
            if (data) {
                statesData = Object.entries(data).sort();
                let sIdx = 0;
                statesData.forEach((stateData) => {
                    // console.log(`stateData[0]: `, stateData[0]);
                    // console.log(`stateData[1]: `, stateData[1]);
                    const state = this.makeUsState(sIdx, stateData[0]);
                    sIdx++;
                    let cIdx = 0;
                    stateData[1].sort().forEach((cityData) => {
                        const city = this.makeUsCityWithStateName(cIdx, cityData, state.stateName);
                        cIdx++;
                        state.cities.push(city);
                    });
                    states.push(state);
                });
            }
            // console.log(`StateService, getUsStateCity, states: `, states);
            console.log('StateService, getUsStateCity result.size: ', (states && states.length) || '0');
            return states;
        }));
    }
    getUsStateCitySlice(indexes) {
        return this.getUsStateCity().pipe(map((items) => {
            const result = [];
            items.forEach((item) => {
                if (indexes.includes(item.id)) {
                    result.push(item);
                }
            });
            return result;
        }));
    }
    getUsCities() {
        let cities = [];
        let retCities = [];
        return this.getUsStateCity().pipe(map((states) => {
            // console.log(`states: `, states);
            states.forEach((state) => {
                state.cities.forEach((cityData) => {
                    // console.log(`cityData: `, cityData);
                    const newCity = this.makeUsCityWithStateName(0, cityData.cityName, cityData.inStateName);
                    cities.push(cityData);
                });
            });
            cities.sort((a, b) => a.cityName.localeCompare(b.cityName));
            let cIdx = 0;
            cities.forEach((city) => {
                const newCity = this.makeUsCityWithStateName(cIdx, city.cityName, city.inStateName);
                cIdx++;
                retCities.push(newCity);
            });
            console.log(`Num of cities: `, retCities.length);
            return retCities;
        }));
    }
    makeUsState(idx, stateName) {
        const state = {};
        state.id = idx;
        state.stateName = stateName;
        state.cities = [];
        return state;
    }
    makeUsCity(idx, cityName) {
        const city = {};
        city.id = idx;
        city.cityName = cityName;
        return city;
    }
    makeUsCityWithStateName(idx, cityName, stateName) {
        const city = this.makeUsCity(idx, cityName);
        city.inStateName = stateName;
        return city;
    }
}
StateService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: StateService, deps: [{ token: i1.HttpClient }], target: i0.ɵɵFactoryTarget.Injectable });
StateService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: StateService, providedIn: 'root' });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.12", ngImport: i0, type: StateService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: function () { return [{ type: i1.HttpClient }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL29vcHMtbGliMDAyL3NyYy9saWIvc2hhcmVkL3NlcnZpY2VzL3N0YXRlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQWMsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsTUFBTSxNQUFNLENBQUM7OztBQU1oRCxNQUFNLE9BQU8sWUFBWTtJQUd2QixZQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3hDLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFO2FBQ3RDLEdBQUcsQ0FBQyxxQ0FBcUMsQ0FBMEIsQ0FBQztJQUN6RSxDQUFDO0lBRUQsV0FBVztRQUNULE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQztJQUM5QixDQUFDO0lBRUQsY0FBYyxDQUFDLElBQVk7UUFDekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN2QyxJQUFJLElBQUksS0FBSyxFQUFFLEVBQUU7WUFDZixPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUNmO1FBQ0QsT0FBTyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxDQUM1QixHQUFHLENBQUMsQ0FBQyxLQUFnQixFQUFFLEVBQUU7WUFDdkIsT0FBTyxDQUNMLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFhLEVBQUUsRUFBRTtnQkFDN0IsNkZBQTZGO2dCQUM3RixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN2RSxDQUFDLENBQUMsSUFBSSxFQUFF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RUQsVUFBVSxDQUFDLEdBQVcsRUFBRSxRQUFnQjtRQUN0QyxNQUFNLElBQUksR0FBVyxFQUFZLENBQUM7UUFDbEMsSUFBSSxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUM7UUFDZCxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUV6QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCx1QkFBdUIsQ0FBQyxHQUFXLEVBQUUsUUFBZ0IsRUFBRSxTQUFpQjtRQUN0RSxNQUFNLElBQUksR0FBVyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNwRCxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztRQUM3QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7OzBHQWpJVSxZQUFZOzhHQUFaLFlBQVksY0FGWCxNQUFNOzRGQUVQLFlBQVk7a0JBSHhCLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSHR0cENsaWVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcclxuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgbWFwLCB0YXAgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgVXNDaXR5LCBVc1N0YXRlIH0gZnJvbSAnLi4vbW9kZWxzJztcclxuXHJcbkBJbmplY3RhYmxlKHtcclxuICBwcm92aWRlZEluOiAncm9vdCcsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTdGF0ZVNlcnZpY2Uge1xyXG4gIGVycm9yTWVzc2FnZT86IHN0cmluZztcclxuICBzdGF0ZXNXaXRoRmxhZyQ6IE9ic2VydmFibGU8VXNTdGF0ZVtdPjtcclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHBDbGllbnQ6IEh0dHBDbGllbnQpIHtcclxuICAgIHRoaXMuc3RhdGVzV2l0aEZsYWckID0gdGhpcy5odHRwQ2xpZW50IC8vXHJcbiAgICAgIC5nZXQoJ2Fzc2V0cy9tb2NrZGF0YS9zdGF0ZXNXaXRoRmxhZy5qc29uJykgYXMgT2JzZXJ2YWJsZTxVc1N0YXRlW10+O1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNTdGF0ZXMoKTogT2JzZXJ2YWJsZTxVc1N0YXRlW10+IHtcclxuICAgIHJldHVybiB0aGlzLnN0YXRlc1dpdGhGbGFnJDtcclxuICB9XHJcblxyXG4gIHNlYXJjaFVzU3RhdGVzKHRlcm06IHN0cmluZyk6IE9ic2VydmFibGU8VXNTdGF0ZVtdPiB7XHJcbiAgICBjb25zb2xlLmxvZygnc2VhcmNoU3RhdGVzIC4uLi4nLCB0ZXJtKTtcclxuICAgIGlmICh0ZXJtID09PSAnJykge1xyXG4gICAgICByZXR1cm4gb2YoW10pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuZ2V0VXNTdGF0ZXMoKS5waXBlKFxyXG4gICAgICBtYXAoKGl0ZW1zOiBVc1N0YXRlW10pID0+IHtcclxuICAgICAgICByZXR1cm4gKFxyXG4gICAgICAgICAgaXRlbXMuZmlsdGVyKChpdGVtOiBVc1N0YXRlKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdzZWFyY2hTdGF0ZSAuLi4nLCB0ZXJtLCBpdGVtLm5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRlcm0udG9Mb3dlckNhc2UoKSkpO1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbS5zdGF0ZU5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHRlcm0udG9Mb3dlckNhc2UoKSkgPj0gMDtcclxuICAgICAgICAgIH0pIHx8IFtdXHJcbiAgICAgICAgKTtcclxuICAgICAgfSksXHJcbiAgICAgIHRhcCgoaXRlbXMpID0+IGNvbnNvbGUubG9nKCdzZWFyY2ggcmVzdWx0LnNpemU6ICcsIChpdGVtcyAmJiBpdGVtcy5sZW5ndGgpIHx8ICcwJykpXHJcbiAgICAgIC8vIHRhcCgoaXRlbXMpID0+IGNvbnNvbGUubG9nKCdzZWFyY2ggcmVzdWx0LnNpemU6ICcsIGl0ZW1zKSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRVc1N0YXRlQ2l0eSgpOiBPYnNlcnZhYmxlPFVzU3RhdGVbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cENsaWVudC5nZXQoJ2Fzc2V0cy9tb2NrZGF0YS9jaXRpZXMuanNvbicpLnBpcGUoXHJcbiAgICAgIG1hcCgoZGF0YSkgPT4ge1xyXG4gICAgICAgIGxldCBzdGF0ZXNEYXRhOiBbc3RyaW5nLCBhbnldW107XHJcbiAgICAgICAgbGV0IHN0YXRlczogVXNTdGF0ZVtdID0gW107XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ0xvYWRpbmcgc3RhdGVzIGFuZCBjaXRpZXMgLi4uLi4gJywgZGF0YSk7XHJcbiAgICAgICAgaWYgKGRhdGEpIHtcclxuICAgICAgICAgIHN0YXRlc0RhdGEgPSBPYmplY3QuZW50cmllcyhkYXRhKS5zb3J0KCk7XHJcblxyXG4gICAgICAgICAgbGV0IHNJZHggPSAwO1xyXG4gICAgICAgICAgc3RhdGVzRGF0YS5mb3JFYWNoKChzdGF0ZURhdGEpID0+IHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYHN0YXRlRGF0YVswXTogYCwgc3RhdGVEYXRhWzBdKTtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYHN0YXRlRGF0YVsxXTogYCwgc3RhdGVEYXRhWzFdKTtcclxuICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLm1ha2VVc1N0YXRlKHNJZHgsIHN0YXRlRGF0YVswXSk7XHJcbiAgICAgICAgICAgIHNJZHgrKztcclxuXHJcbiAgICAgICAgICAgIGxldCBjSWR4ID0gMDtcclxuICAgICAgICAgICAgc3RhdGVEYXRhWzFdLnNvcnQoKS5mb3JFYWNoKChjaXR5RGF0YSkgPT4ge1xyXG4gICAgICAgICAgICAgIGNvbnN0IGNpdHkgPSB0aGlzLm1ha2VVc0NpdHlXaXRoU3RhdGVOYW1lKGNJZHgsIGNpdHlEYXRhLCBzdGF0ZS5zdGF0ZU5hbWUpO1xyXG4gICAgICAgICAgICAgIGNJZHgrKztcclxuICAgICAgICAgICAgICBzdGF0ZS5jaXRpZXMucHVzaChjaXR5KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHN0YXRlcy5wdXNoKHN0YXRlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhgU3RhdGVTZXJ2aWNlLCBnZXRVc1N0YXRlQ2l0eSwgc3RhdGVzOiBgLCBzdGF0ZXMpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdTdGF0ZVNlcnZpY2UsIGdldFVzU3RhdGVDaXR5IHJlc3VsdC5zaXplOiAnLCAoc3RhdGVzICYmIHN0YXRlcy5sZW5ndGgpIHx8ICcwJyk7XHJcbiAgICAgICAgcmV0dXJuIHN0YXRlcztcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRVc1N0YXRlQ2l0eVNsaWNlKGluZGV4ZXM6IG51bWJlcltdKTogT2JzZXJ2YWJsZTxVc1N0YXRlW10+IHtcclxuICAgIHJldHVybiB0aGlzLmdldFVzU3RhdGVDaXR5KCkucGlwZShcclxuICAgICAgbWFwKChpdGVtczogVXNTdGF0ZVtdKSA9PiB7XHJcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XHJcbiAgICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbTogVXNTdGF0ZSkgPT4ge1xyXG4gICAgICAgICAgaWYgKGluZGV4ZXMuaW5jbHVkZXMoaXRlbS5pZCkpIHtcclxuICAgICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRVc0NpdGllcygpIHtcclxuICAgIGxldCBjaXRpZXM6IFVzQ2l0eVtdID0gW107XHJcbiAgICBsZXQgcmV0Q2l0aWVzOiBVc0NpdHlbXSA9IFtdO1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0VXNTdGF0ZUNpdHkoKS5waXBlKFxyXG4gICAgICBtYXAoKHN0YXRlcykgPT4ge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGBzdGF0ZXM6IGAsIHN0YXRlcyk7XHJcbiAgICAgICAgc3RhdGVzLmZvckVhY2goKHN0YXRlKSA9PiB7XHJcbiAgICAgICAgICBzdGF0ZS5jaXRpZXMuZm9yRWFjaCgoY2l0eURhdGEpID0+IHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYGNpdHlEYXRhOiBgLCBjaXR5RGF0YSk7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld0NpdHkgPSB0aGlzLm1ha2VVc0NpdHlXaXRoU3RhdGVOYW1lKFxyXG4gICAgICAgICAgICAgIDAsXHJcbiAgICAgICAgICAgICAgY2l0eURhdGEuY2l0eU5hbWUsXHJcbiAgICAgICAgICAgICAgY2l0eURhdGEuaW5TdGF0ZU5hbWVcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgY2l0aWVzLnB1c2goY2l0eURhdGEpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNpdGllcy5zb3J0KChhLCBiKSA9PiBhLmNpdHlOYW1lLmxvY2FsZUNvbXBhcmUoYi5jaXR5TmFtZSkpO1xyXG4gICAgICAgIGxldCBjSWR4ID0gMDtcclxuICAgICAgICBjaXRpZXMuZm9yRWFjaCgoY2l0eSkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgbmV3Q2l0eSA9IHRoaXMubWFrZVVzQ2l0eVdpdGhTdGF0ZU5hbWUoY0lkeCwgY2l0eS5jaXR5TmFtZSwgY2l0eS5pblN0YXRlTmFtZSk7XHJcbiAgICAgICAgICBjSWR4Kys7XHJcbiAgICAgICAgICByZXRDaXRpZXMucHVzaChuZXdDaXR5KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zb2xlLmxvZyhgTnVtIG9mIGNpdGllczogYCwgcmV0Q2l0aWVzLmxlbmd0aCk7XHJcbiAgICAgICAgcmV0dXJuIHJldENpdGllcztcclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBtYWtlVXNTdGF0ZShpZHg6IG51bWJlciwgc3RhdGVOYW1lOiBzdHJpbmcpOiBVc1N0YXRlIHtcclxuICAgIGNvbnN0IHN0YXRlOiBVc1N0YXRlID0ge30gYXMgVXNTdGF0ZTtcclxuICAgIHN0YXRlLmlkID0gaWR4O1xyXG4gICAgc3RhdGUuc3RhdGVOYW1lID0gc3RhdGVOYW1lO1xyXG4gICAgc3RhdGUuY2l0aWVzID0gW107XHJcblxyXG4gICAgcmV0dXJuIHN0YXRlO1xyXG4gIH1cclxuXHJcbiAgbWFrZVVzQ2l0eShpZHg6IG51bWJlciwgY2l0eU5hbWU6IHN0cmluZyk6IFVzQ2l0eSB7XHJcbiAgICBjb25zdCBjaXR5OiBVc0NpdHkgPSB7fSBhcyBVc0NpdHk7XHJcbiAgICBjaXR5LmlkID0gaWR4O1xyXG4gICAgY2l0eS5jaXR5TmFtZSA9IGNpdHlOYW1lO1xyXG5cclxuICAgIHJldHVybiBjaXR5O1xyXG4gIH1cclxuXHJcbiAgbWFrZVVzQ2l0eVdpdGhTdGF0ZU5hbWUoaWR4OiBudW1iZXIsIGNpdHlOYW1lOiBzdHJpbmcsIHN0YXRlTmFtZTogc3RyaW5nKTogVXNDaXR5IHtcclxuICAgIGNvbnN0IGNpdHk6IFVzQ2l0eSA9IHRoaXMubWFrZVVzQ2l0eShpZHgsIGNpdHlOYW1lKTtcclxuICAgIGNpdHkuaW5TdGF0ZU5hbWUgPSBzdGF0ZU5hbWU7XHJcbiAgICByZXR1cm4gY2l0eTtcclxuICB9XHJcbn1cclxuIl19