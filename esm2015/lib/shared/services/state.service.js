import { Injectable } from '@angular/core';
import { of, map, tap } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
export class StateService {
    constructor(httpClient) {
        this.httpClient = httpClient;
        this.statesWithFlag$ = this.httpClient //
            .get('assets/mockdata/statesWithFlag.json');
    }
    getUsStates() {
        return this.statesWithFlag$;
    }
    searchUsStates(term) {
        console.log('searchStates ....', term);
        if (term === '') {
            return of([]);
        }
        return this.getUsStates().pipe(map((items) => {
            return (items.filter((item) => {
                // console.log('searchState ...', term, item.name.toLowerCase().indexOf(term.toLowerCase()));
                return item.stateName.toLowerCase().indexOf(term.toLowerCase()) >= 0;
            }) || []);
        }), tap((items) => console.log('search result.size: ', (items && items.length) || '0'))
        // tap((items) => console.log('search result.size: ', items))
        );
    }
    getUsStateCity() {
        return this.httpClient.get('assets/mockdata/cities.json').pipe(map((data) => {
            let statesData;
            let states = [];
            // console.log('Loading states and cities ..... ', data);
            if (data) {
                statesData = Object.entries(data).sort();
                let sIdx = 0;
                statesData.forEach((stateData) => {
                    // console.log(`stateData[0]: `, stateData[0]);
                    // console.log(`stateData[1]: `, stateData[1]);
                    const state = this.makeUsState(sIdx, stateData[0]);
                    sIdx++;
                    let cIdx = 0;
                    stateData[1].sort().forEach((cityData) => {
                        const city = this.makeUsCityWithStateName(cIdx, cityData, state.stateName);
                        cIdx++;
                        state.cities.push(city);
                    });
                    states.push(state);
                });
            }
            // console.log(`StateService, getUsStateCity, states: `, states);
            console.log('StateService, getUsStateCity result.size: ', (states && states.length) || '0');
            return states;
        }));
    }
    getUsStateCitySlice(indexes) {
        return this.getUsStateCity().pipe(map((items) => {
            const result = [];
            items.forEach((item) => {
                if (indexes.includes(item.id)) {
                    result.push(item);
                }
            });
            return result;
        }));
    }
    getUsCities() {
        let cities = [];
        let retCities = [];
        return this.getUsStateCity().pipe(map((states) => {
            // console.log(`states: `, states);
            states.forEach((state) => {
                state.cities.forEach((cityData) => {
                    // console.log(`cityData: `, cityData);
                    const newCity = this.makeUsCityWithStateName(0, cityData.cityName, cityData.inStateName);
                    cities.push(cityData);
                });
            });
            cities.sort((a, b) => a.cityName.localeCompare(b.cityName));
            let cIdx = 0;
            cities.forEach((city) => {
                const newCity = this.makeUsCityWithStateName(cIdx, city.cityName, city.inStateName);
                cIdx++;
                retCities.push(newCity);
            });
            console.log(`Num of cities: `, retCities.length);
            return retCities;
        }));
    }
    makeUsState(idx, stateName) {
        const state = {};
        state.id = idx;
        state.stateName = stateName;
        state.cities = [];
        return state;
    }
    makeUsCity(idx, cityName) {
        const city = {};
        city.id = idx;
        city.cityName = cityName;
        return city;
    }
    makeUsCityWithStateName(idx, cityName, stateName) {
        const city = this.makeUsCity(idx, cityName);
        city.inStateName = stateName;
        return city;
    }
}
StateService.ɵfac = function StateService_Factory(t) { return new (t || StateService)(i0.ɵɵinject(i1.HttpClient)); };
StateService.ɵprov = i0.ɵɵdefineInjectable({ token: StateService, factory: StateService.ɵfac, providedIn: 'root' });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(StateService, [{
        type: Injectable,
        args: [{
                providedIn: 'root',
            }]
    }], function () { return [{ type: i1.HttpClient }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJDOi9vb3BzbWFpbHMvMDAxLW9vcHNtYWlscy1hbmd1bGFyLWxpYi10ZXN0L3Byb2plY3RzL29vcHMtbGliMDAyL3NyYy8iLCJzb3VyY2VzIjpbImxpYi9zaGFyZWQvc2VydmljZXMvc3RhdGUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBYyxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxNQUFNLE1BQU0sQ0FBQzs7O0FBTWhELE1BQU0sT0FBTyxZQUFZO0lBR3ZCLFlBQW9CLFVBQXNCO1FBQXRCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDeEMsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUU7YUFDdEMsR0FBRyxDQUFDLHFDQUFxQyxDQUEwQixDQUFDO0lBQ3pFLENBQUM7SUFFRCxXQUFXO1FBQ1QsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDO0lBQzlCLENBQUM7SUFFRCxjQUFjLENBQUMsSUFBWTtRQUN6QixPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3ZDLElBQUksSUFBSSxLQUFLLEVBQUUsRUFBRTtZQUNmLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ2Y7UUFDRCxPQUFPLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxJQUFJLENBQzVCLEdBQUcsQ0FBQyxDQUFDLEtBQWdCLEVBQUUsRUFBRTtZQUN2QixPQUFPLENBQ0wsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQWEsRUFBRSxFQUFFO2dCQUM3Qiw2RkFBNkY7Z0JBQzdGLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFD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QUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCxVQUFVLENBQUMsR0FBVyxFQUFFLFFBQWdCO1FBQ3RDLE1BQU0sSUFBSSxHQUFXLEVBQVksQ0FBQztRQUNsQyxJQUFJLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQztRQUNkLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBRXpCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELHVCQUF1QixDQUFDLEdBQVcsRUFBRSxRQUFnQixFQUFFLFNBQWlCO1FBQ3RFLE1BQU0sSUFBSSxHQUFXLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1FBQzdCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQzs7d0VBaklVLFlBQVk7b0RBQVosWUFBWSxXQUFaLFlBQVksbUJBRlgsTUFBTTtrREFFUCxZQUFZO2NBSHhCLFVBQVU7ZUFBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIG1hcCwgdGFwIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IFVzQ2l0eSwgVXNTdGF0ZSB9IGZyb20gJy4uL21vZGVscyc7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgU3RhdGVTZXJ2aWNlIHtcclxuICBlcnJvck1lc3NhZ2U/OiBzdHJpbmc7XHJcbiAgc3RhdGVzV2l0aEZsYWckOiBPYnNlcnZhYmxlPFVzU3RhdGVbXT47XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwQ2xpZW50OiBIdHRwQ2xpZW50KSB7XHJcbiAgICB0aGlzLnN0YXRlc1dpdGhGbGFnJCA9IHRoaXMuaHR0cENsaWVudCAvL1xyXG4gICAgICAuZ2V0KCdhc3NldHMvbW9ja2RhdGEvc3RhdGVzV2l0aEZsYWcuanNvbicpIGFzIE9ic2VydmFibGU8VXNTdGF0ZVtdPjtcclxuICB9XHJcblxyXG4gIGdldFVzU3RhdGVzKCk6IE9ic2VydmFibGU8VXNTdGF0ZVtdPiB7XHJcbiAgICByZXR1cm4gdGhpcy5zdGF0ZXNXaXRoRmxhZyQ7XHJcbiAgfVxyXG5cclxuICBzZWFyY2hVc1N0YXRlcyh0ZXJtOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFVzU3RhdGVbXT4ge1xyXG4gICAgY29uc29sZS5sb2coJ3NlYXJjaFN0YXRlcyAuLi4uJywgdGVybSk7XHJcbiAgICBpZiAodGVybSA9PT0gJycpIHtcclxuICAgICAgcmV0dXJuIG9mKFtdKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmdldFVzU3RhdGVzKCkucGlwZShcclxuICAgICAgbWFwKChpdGVtczogVXNTdGF0ZVtdKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgIGl0ZW1zLmZpbHRlcigoaXRlbTogVXNTdGF0ZSkgPT4ge1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnc2VhcmNoU3RhdGUgLi4uJywgdGVybSwgaXRlbS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0ZXJtLnRvTG93ZXJDYXNlKCkpKTtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uc3RhdGVOYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0ZXJtLnRvTG93ZXJDYXNlKCkpID49IDA7XHJcbiAgICAgICAgICB9KSB8fCBbXVxyXG4gICAgICAgICk7XHJcbiAgICAgIH0pLFxyXG4gICAgICB0YXAoKGl0ZW1zKSA9PiBjb25zb2xlLmxvZygnc2VhcmNoIHJlc3VsdC5zaXplOiAnLCAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoKSB8fCAnMCcpKVxyXG4gICAgICAvLyB0YXAoKGl0ZW1zKSA9PiBjb25zb2xlLmxvZygnc2VhcmNoIHJlc3VsdC5zaXplOiAnLCBpdGVtcykpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNTdGF0ZUNpdHkoKTogT2JzZXJ2YWJsZTxVc1N0YXRlW10+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHBDbGllbnQuZ2V0KCdhc3NldHMvbW9ja2RhdGEvY2l0aWVzLmpzb24nKS5waXBlKFxyXG4gICAgICBtYXAoKGRhdGEpID0+IHtcclxuICAgICAgICBsZXQgc3RhdGVzRGF0YTogW3N0cmluZywgYW55XVtdO1xyXG4gICAgICAgIGxldCBzdGF0ZXM6IFVzU3RhdGVbXSA9IFtdO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdMb2FkaW5nIHN0YXRlcyBhbmQgY2l0aWVzIC4uLi4uICcsIGRhdGEpO1xyXG4gICAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgICBzdGF0ZXNEYXRhID0gT2JqZWN0LmVudHJpZXMoZGF0YSkuc29ydCgpO1xyXG5cclxuICAgICAgICAgIGxldCBzSWR4ID0gMDtcclxuICAgICAgICAgIHN0YXRlc0RhdGEuZm9yRWFjaCgoc3RhdGVEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBzdGF0ZURhdGFbMF06IGAsIHN0YXRlRGF0YVswXSk7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBzdGF0ZURhdGFbMV06IGAsIHN0YXRlRGF0YVsxXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gdGhpcy5tYWtlVXNTdGF0ZShzSWR4LCBzdGF0ZURhdGFbMF0pO1xyXG4gICAgICAgICAgICBzSWR4Kys7XHJcblxyXG4gICAgICAgICAgICBsZXQgY0lkeCA9IDA7XHJcbiAgICAgICAgICAgIHN0YXRlRGF0YVsxXS5zb3J0KCkuZm9yRWFjaCgoY2l0eURhdGEpID0+IHtcclxuICAgICAgICAgICAgICBjb25zdCBjaXR5ID0gdGhpcy5tYWtlVXNDaXR5V2l0aFN0YXRlTmFtZShjSWR4LCBjaXR5RGF0YSwgc3RhdGUuc3RhdGVOYW1lKTtcclxuICAgICAgICAgICAgICBjSWR4Kys7XHJcbiAgICAgICAgICAgICAgc3RhdGUuY2l0aWVzLnB1c2goY2l0eSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBzdGF0ZXMucHVzaChzdGF0ZSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coYFN0YXRlU2VydmljZSwgZ2V0VXNTdGF0ZUNpdHksIHN0YXRlczogYCwgc3RhdGVzKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnU3RhdGVTZXJ2aWNlLCBnZXRVc1N0YXRlQ2l0eSByZXN1bHQuc2l6ZTogJywgKHN0YXRlcyAmJiBzdGF0ZXMubGVuZ3RoKSB8fCAnMCcpO1xyXG4gICAgICAgIHJldHVybiBzdGF0ZXM7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNTdGF0ZUNpdHlTbGljZShpbmRleGVzOiBudW1iZXJbXSk6IE9ic2VydmFibGU8VXNTdGF0ZVtdPiB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRVc1N0YXRlQ2l0eSgpLnBpcGUoXHJcbiAgICAgIG1hcCgoaXRlbXM6IFVzU3RhdGVbXSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIGl0ZW1zLmZvckVhY2goKGl0ZW06IFVzU3RhdGUpID0+IHtcclxuICAgICAgICAgIGlmIChpbmRleGVzLmluY2x1ZGVzKGl0ZW0uaWQpKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNDaXRpZXMoKSB7XHJcbiAgICBsZXQgY2l0aWVzOiBVc0NpdHlbXSA9IFtdO1xyXG4gICAgbGV0IHJldENpdGllczogVXNDaXR5W10gPSBbXTtcclxuICAgIHJldHVybiB0aGlzLmdldFVzU3RhdGVDaXR5KCkucGlwZShcclxuICAgICAgbWFwKChzdGF0ZXMpID0+IHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhgc3RhdGVzOiBgLCBzdGF0ZXMpO1xyXG4gICAgICAgIHN0YXRlcy5mb3JFYWNoKChzdGF0ZSkgPT4ge1xyXG4gICAgICAgICAgc3RhdGUuY2l0aWVzLmZvckVhY2goKGNpdHlEYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBjaXR5RGF0YTogYCwgY2l0eURhdGEpO1xyXG4gICAgICAgICAgICBjb25zdCBuZXdDaXR5ID0gdGhpcy5tYWtlVXNDaXR5V2l0aFN0YXRlTmFtZShcclxuICAgICAgICAgICAgICAwLFxyXG4gICAgICAgICAgICAgIGNpdHlEYXRhLmNpdHlOYW1lLFxyXG4gICAgICAgICAgICAgIGNpdHlEYXRhLmluU3RhdGVOYW1lXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIGNpdGllcy5wdXNoKGNpdHlEYXRhKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjaXRpZXMuc29ydCgoYSwgYikgPT4gYS5jaXR5TmFtZS5sb2NhbGVDb21wYXJlKGIuY2l0eU5hbWUpKTtcclxuICAgICAgICBsZXQgY0lkeCA9IDA7XHJcbiAgICAgICAgY2l0aWVzLmZvckVhY2goKGNpdHkpID0+IHtcclxuICAgICAgICAgIGNvbnN0IG5ld0NpdHkgPSB0aGlzLm1ha2VVc0NpdHlXaXRoU3RhdGVOYW1lKGNJZHgsIGNpdHkuY2l0eU5hbWUsIGNpdHkuaW5TdGF0ZU5hbWUpO1xyXG4gICAgICAgICAgY0lkeCsrO1xyXG4gICAgICAgICAgcmV0Q2l0aWVzLnB1c2gobmV3Q2l0eSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coYE51bSBvZiBjaXRpZXM6IGAsIHJldENpdGllcy5sZW5ndGgpO1xyXG4gICAgICAgIHJldHVybiByZXRDaXRpZXM7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgbWFrZVVzU3RhdGUoaWR4OiBudW1iZXIsIHN0YXRlTmFtZTogc3RyaW5nKTogVXNTdGF0ZSB7XHJcbiAgICBjb25zdCBzdGF0ZTogVXNTdGF0ZSA9IHt9IGFzIFVzU3RhdGU7XHJcbiAgICBzdGF0ZS5pZCA9IGlkeDtcclxuICAgIHN0YXRlLnN0YXRlTmFtZSA9IHN0YXRlTmFtZTtcclxuICAgIHN0YXRlLmNpdGllcyA9IFtdO1xyXG5cclxuICAgIHJldHVybiBzdGF0ZTtcclxuICB9XHJcblxyXG4gIG1ha2VVc0NpdHkoaWR4OiBudW1iZXIsIGNpdHlOYW1lOiBzdHJpbmcpOiBVc0NpdHkge1xyXG4gICAgY29uc3QgY2l0eTogVXNDaXR5ID0ge30gYXMgVXNDaXR5O1xyXG4gICAgY2l0eS5pZCA9IGlkeDtcclxuICAgIGNpdHkuY2l0eU5hbWUgPSBjaXR5TmFtZTtcclxuXHJcbiAgICByZXR1cm4gY2l0eTtcclxuICB9XHJcblxyXG4gIG1ha2VVc0NpdHlXaXRoU3RhdGVOYW1lKGlkeDogbnVtYmVyLCBjaXR5TmFtZTogc3RyaW5nLCBzdGF0ZU5hbWU6IHN0cmluZyk6IFVzQ2l0eSB7XHJcbiAgICBjb25zdCBjaXR5OiBVc0NpdHkgPSB0aGlzLm1ha2VVc0NpdHkoaWR4LCBjaXR5TmFtZSk7XHJcbiAgICBjaXR5LmluU3RhdGVOYW1lID0gc3RhdGVOYW1lO1xyXG4gICAgcmV0dXJuIGNpdHk7XHJcbiAgfVxyXG59XHJcbiJdfQ==